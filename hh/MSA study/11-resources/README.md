## 11 분산을 고려한 비즈니스 로직 만들기

#### 11.1 마이크로서비스와 공유 자원

마이크로서비스는 프로세스를 독립적으로 실행하기 때문에 공통으로 접근해야 하는 공유 자원을 고려해야 한다. 가장 쉬운 방법으로는 __데이터베이스__ 처럼 데이터를 저장하는 저장소를 공통으로 사용하는 것이다. 그러나 이것은 데이터베이스에 부하가 집중될 경우 마이크로 서비스를 아무리 분산배치해도 __부하를 감당할 수 없다__ 는 치명적인 문제가 있다.


#### 11.2 공유 자원 처리

마이크로 서비스 아키텍처는 프로세스 단위로 분리되어 있기 때문에 물리적으로 다른 머신에서 실행될 경우 공유 자원에 접근하기 어렵다는 단점이 있다.

이러한 문제를 해결하는 가장 직관적인 방법은 한쪽은 정보를 가지고 다른 한쪽은 질의를 하는 것이다.

![idea](./img/idea.png)

지금 Distributor가 모든 마이크로 서비스의 접속 정보를 알고 있으므로 Distributor에서 정보를 받아 해당 마이크로서비스에 질의하면 됩니다. 특정 마이크로서비스가 공유 자원이 필요한 다른 모든 마이크로서비스에 변경 사항을 알려 주는 것 등 다른 방법들이 존재한다.

#### 11.3 Redis 활용

마이크로 서비스 아키텍처에서 공유 자원 문제를 해결하는 가장 쉬운 방법은 데이터베이스 하나에 여러 마이크로서비스가 접근하는 것이다. 이때 발생하는 부하 문제만 해결할 수 있다면 매우 좋은 해법이 될 것이다.

이러한 관점에서 __메모리 캐싱__ 시스템을 널리 활용하고 있다. 이를 이용해 빈번하게 호출하지만 변경할 일은 적은 데이터를 별도의 메모리 캐싱 시스템에 저장해 놓고 데이터베이스에 질의하는 대신 미리 저장해 둔 데이터를 이용하면 데이터베이스의 부하를 줄일 수 있다. 대표적인 메모리 캐싱 시스템 중 하나인 Redis를 사용해본다.

##### 11.3.1 Redis 기능

Redis는 키-값 기반의 캐싱 기능 이외에도 다양한 기능을 제공한다.

* 랭킹
* 채팅
* 좋아요/싫어요
* 별점
* 지리정보
* 보안

##### 11.3.2 Redis 연동

Redis는 공식적으로 윈도에서 지원하지 않지만 https://github.com/MicroSoftArchive/redis/releases 에서도 윈도용 인스톨러를 내려받아 설치할 수 있다.

<pre>
>npm install redis
</pre>

>이후 각 microservice에 redis 적용 코드 추가